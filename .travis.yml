language: ruby
cache:
  bundler: true
  yarn: true
  directories:
  - $HOME/.cache/yarn
  - client/node_modules # Remove this when testing multiple versions of Node
rvm:
  - 2.3.4
  - 2.4.1
before_install:
  - nvm install 7.10.0
  - node -v
  - npm install -g yarn
  - (cd client && yarn install)
before_script:
  - (git submodule init && git submodule update)
  - mkdir data
  - bundle exec rails db:create
  - bundle exec rails db:migrate
script:
  - bundle exec rspec
  - (cd client && yarn run test)
